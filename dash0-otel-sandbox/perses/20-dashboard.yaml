kind: Dashboard
metadata:
  project: perses
  name: application-dashboard
spec:
  display:
    name: "Application Metrics"
    description: "Application-focused metrics for the platform request service"
  duration: 1h
  panels:
    RequestsRate:
      kind: Panel
      spec:
        display:
          name: "Request Rate"
          description: "Rate of platform requests per second"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "rate(platform_requests_total[5m])"
    RequestsByTeam:
      kind: Panel
      spec:
        display:
          name: "Requests by Team"
          description: "Platform requests broken down by team"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "sum by (team) (rate(platform_requests_total[5m]))"
    RequestsByType:
      kind: Panel
      spec:
        display:
          name: "Requests by Type"
          description: "Platform requests broken down by request type"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "sum by (request_type) (rate(platform_requests_total[5m]))"
    HttpRequestsRate:
      kind: Panel
      spec:
        display:
          name: "HTTP Request Rate"
          description: "HTTP requests per second"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "rate(http_server_request_duration_seconds_count[5m])"
    ResponseTimeP95:
      kind: Panel
      spec:
        display:
          name: "Response Time 95th Percentile"
          description: "95th percentile response time"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "histogram_quantile(0.95, rate(http_server_request_duration_seconds_bucket[5m]))"
    CustomResponseTime:
      kind: Panel
      spec:
        display:
          name: "Initial Response Time"
          description: "Custom time to initial response metric"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "histogram_quantile(0.95, rate(time_to_initial_response_seconds_milliseconds_bucket[5m]))"
  layouts:
    - kind: Grid
      spec:
        display:
          title: "Request Metrics"
          collapse:
            open: true
        items:
          - x: 0
            y: 0
            width: 8
            height: 8
            content:
              $ref: "#/spec/panels/RequestsRate"
          - x: 8
            y: 0
            width: 8
            height: 8
            content:
              $ref: "#/spec/panels/RequestsByTeam"
          - x: 16
            y: 0
            width: 8
            height: 8
            content:
              $ref: "#/spec/panels/RequestsByType"
    - kind: Grid
      spec:
        display:
          title: "HTTP Performance"
          collapse:
            open: true
        items:
          - x: 0
            y: 8
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/HttpRequestsRate"
          - x: 6
            y: 8
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/ResponseTimeP95"
          - x: 12
            y: 8
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/CustomResponseTime"