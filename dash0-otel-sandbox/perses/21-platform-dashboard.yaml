kind: Dashboard
metadata:
  project: perses
  name: platform-dashboard
spec:
  display:
    name: "Platform Infrastructure"
    description: "Platform-focused metrics for JVM, system resources, and infrastructure"
  duration: 1h
  panels:
    ServiceUp:
      kind: Panel
      spec:
        display:
          name: "Service Availability"
          description: "Service up/down status"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "up"
    JVMMemoryUsed:
      kind: Panel
      spec:
        display:
          name: "JVM Memory Used"
          description: "Memory usage by area"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "jvm_memory_used_bytes"
    JVMMemoryLimit:
      kind: Panel
      spec:
        display:
          name: "JVM Memory Limit"
          description: "Maximum memory limit by area"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "jvm_memory_limit_bytes"
    JVMThreads:
      kind: Panel
      spec:
        display:
          name: "JVM Threads"
          description: "Current thread count"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "jvm_thread_count"
    JVMClasses:
      kind: Panel
      spec:
        display:
          name: "JVM Classes"
          description: "Currently loaded classes"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "jvm_class_count"
    GCDuration:
      kind: Panel
      spec:
        display:
          name: "Garbage Collection Duration"
          description: "GC duration rate"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "rate(jvm_gc_duration_seconds_sum[5m])"
    JVMCPUTime:
      kind: Panel
      spec:
        display:
          name: "JVM CPU Time"
          description: "JVM CPU time usage"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "rate(jvm_cpu_time_seconds_total[5m])"
    JVMCPUUtilization:
      kind: Panel
      spec:
        display:
          name: "JVM CPU Utilization"
          description: "Recent JVM CPU utilization ratio"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "jvm_cpu_recent_utilization_ratio"
    ProcessMemory:
      kind: Panel
      spec:
        display:
          name: "Process Memory"
          description: "Process resident memory usage"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "process_resident_memory_bytes"
    DatabaseConnections:
      kind: Panel
      spec:
        display:
          name: "Database Connection Usage"
          description: "Database connection pool usage"
        plugin:
          kind: TimeSeriesChart
          spec: {}
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: "db_client_connections_usage"
  layouts:
    - kind: Grid
      spec:
        display:
          title: "Service Health"
          collapse:
            open: true
        items:
          - x: 0
            y: 0
            width: 12
            height: 8
            content:
              $ref: "#/spec/panels/ServiceUp"
          - x: 12
            y: 0
            width: 12
            height: 8
            content:
              $ref: "#/spec/panels/DatabaseConnections"
    - kind: Grid
      spec:
        display:
          title: "JVM Memory & Resources"
          collapse:
            open: true
        items:
          - x: 0
            y: 8
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/JVMMemoryUsed"
          - x: 6
            y: 8
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/JVMMemoryLimit"
          - x: 12
            y: 8
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/JVMThreads"
          - x: 18
            y: 8
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/ProcessMemory"
    - kind: Grid
      spec:
        display:
          title: "JVM Performance"
          collapse:
            open: true
        items:
          - x: 0
            y: 16
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/JVMCPUTime"
          - x: 6
            y: 16
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/JVMCPUUtilization"
          - x: 12
            y: 16
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/GCDuration"
          - x: 18
            y: 16
            width: 6
            height: 8
            content:
              $ref: "#/spec/panels/JVMClasses"